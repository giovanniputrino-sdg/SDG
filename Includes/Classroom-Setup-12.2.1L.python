{"version":"NotebookV1","origId":779539500128680,"name":"Classroom-Setup-12.2.1L","language":"python","commands":[{"version":"CommandV1","origId":779539500128681,"guid":"9ff0a6e8-1adf-46e6-ac92-4f67895bca97","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"cap_12\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"afbe51ce-cfc3-460b-8849-29f667ddc730"},{"version":"CommandV1","origId":779539500128682,"guid":"b6f44d99-2cf0-4585-bd1a-dfb4414426e5","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"f2401a11-bb1d-4d4f-85d4-53e0a318ca62"},{"version":"CommandV1","origId":779539500128683,"guid":"af575219-8fd4-4da4-98d0-a08fff1d8d28","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    displayHTML(f\"\"\"<body><textarea style=\"width:100%\" rows={rows}> \\n{sql.strip()}</textarea></body>\"\"\")\n    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0bcccdf6-c1e8-4d3d-afe6-15290c5d2cc2"},{"version":"CommandV1","origId":779539500128684,"guid":"d56aadbc-f716-4d40-991f-a646b2c458c6","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_daily_patient_avg():\n    sql = f\"SELECT * FROM {DA.db_name}.daily_patient_avg\"\n    print_sql(3, sql)\n\nDA.generate_daily_patient_avg = _generate_daily_patient_avg","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5d4ab8a5-1c0f-46cd-a5ba-e3a4de11e04b"},{"version":"CommandV1","origId":779539500128685,"guid":"3760abf1-06c6-45ee-8cc7-f303945732a8","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_visualization_query():\n    sql = f\"\"\"\nSELECT flow_name, timestamp, int(details:flow_progress:metrics:num_output_rows) num_output_rows\nFROM {DA.db_name}.dlt_metrics\nORDER BY timestamp DESC;\"\"\"\n    \n    print_sql(5, sql)\n\nDA.generate_visualization_query = _generate_visualization_query","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0daa1eec-9ab9-4f67-96a5-f5a0eadefc7f"},{"version":"CommandV1","origId":779539500128686,"guid":"915a5a95-7919-409f-9431-48c5e5df388b","subtype":"command","commandType":"auto","position":7.0,"command":"generate_register_dlt_event_metrics_sql_string = \"\"\n\ndef _generate_register_dlt_event_metrics_sql():\n    global generate_register_dlt_event_metrics_sql_string\n    \n    generate_register_dlt_event_metrics_sql_string = f\"\"\"\nCREATE TABLE IF NOT EXISTS {DA.db_name}.dlt_events\nLOCATION '{DA.paths.working_dir}/storage/system/events';\n\nCREATE VIEW IF NOT EXISTS {DA.db_name}.dlt_success AS\nSELECT * FROM {DA.db_name}.dlt_events\nWHERE details:flow_progress:metrics IS NOT NULL;\n\nCREATE VIEW IF NOT EXISTS {DA.db_name}.dlt_metrics AS\nSELECT timestamp, origin.flow_name, details \nFROM {DA.db_name}.dlt_success\nORDER BY timestamp DESC;\"\"\".strip()\n    \n    print_sql(13, generate_register_dlt_event_metrics_sql_string)\n    \nDA.generate_register_dlt_event_metrics_sql = _generate_register_dlt_event_metrics_sql","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0745db87-3fca-44b2-900e-f24a0acf2b90"},{"version":"CommandV1","origId":779539500128687,"guid":"bee59bff-b7b0-486f-b87a-3d05bf53c064","subtype":"command","commandType":"auto","position":8.0,"command":"def print_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 12.2.2L - DLT Task\"\n\n    displayHTML(f\"\"\"<table>\n    <tr><td style=\"white-space:nowrap\">Pipeline Name:</td><td><b>Cap-12-{DA.username}</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Source:</td><td><b>{DA.paths.working_dir}/source/tracker</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Target:</td><td><b>{DA.db_name}</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Storage Location:</td><td><b>{DA.paths.working_dir}/storage</b></td></tr>\n    <tr><td style=\"white-space:nowrap\" style=\"white-space:nowrap\">Notebook Path:</td><td><b>{path}</b></td></tr>\n    </table>\"\"\")\n    \ndef print_job_config():\n    displayHTML(f\"\"\"<table>\n    <tr><td style=\"white-space:nowrap\">Job Name:</td><td><b>Cap-12-{DA.username}</b></td></tr>\n    </table>\"\"\")","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2241f3fe-bb87-40db-878c-e58cdb805687"},{"version":"CommandV1","origId":779539500128688,"guid":"0e80ed87-48d9-4103-8e1e-8d7f990cd071","subtype":"command","commandType":"auto","position":9.0,"command":"DA.cleanup()\nDA.init()\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"dd032db6-a4d8-453c-a904-791aa6743660"}],"dashboards":[],"guid":"fca569d3-21c4-47bd-914e-8b7b088fc451","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}