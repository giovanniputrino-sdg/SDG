{"version":"NotebookV1","origId":779539500128664,"name":"Classroom-Setup-8.2.1L","language":"python","commands":[{"version":"CommandV1","origId":779539500128665,"guid":"45eb9e2f-93d8-4545-b504-5ba4d3c69356","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"dlt_lab_82\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ffe92bed-75b2-4a3c-a2b4-be6a66d8b731"},{"version":"CommandV1","origId":779539500128666,"guid":"cd4ad1ef-fefb-42c4-97bf-34a34506995b","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a3aaaa1d-de44-425e-bf54-da8ea2e4d1a5"},{"version":"CommandV1","origId":779539500128667,"guid":"1c3ad8b8-cfa1-4268-a633-ad4b78bd67c3","subtype":"command","commandType":"auto","position":4.0,"command":"def get_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 8.2.2L - Migrating a SQL Pipeline to DLT Lab\"\n    \n    pipeline_name = f\"DLT-Lab-82L-{DA.username}\"\n    source = f\"{DA.paths.working_dir}/source/tracker\"\n    return pipeline_name, path, source\n    \ndef _print_pipeline_config():\n    \"Provided by DBAcademy, this function renders the configuration of the pipeline as HTML\"\n    pipeline_name, path, source = get_pipeline_config()\n    \n    displayHTML(f\"\"\"<table style=\"width:100%\">\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Pipeline Name:</td>\n        <td><input type=\"text\" value=\"{pipeline_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Target:</td>\n        <td><input type=\"text\" value=\"{DA.db_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Storage Location:</td>\n        <td><input type=\"text\" value=\"{DA.paths.working_dir}/storage\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Notebook Path:</td>\n        <td><input type=\"text\" value=\"{path}\" style=\"width:100%\"></td>\n    </tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Source:</td>\n        <td><input type=\"text\" value=\"{source}\" style=\"width:100%\"></td>\n    </tr>\n    </table>\"\"\")\n    \nDA.print_pipeline_config = _print_pipeline_config    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fdc9339b-cc48-496b-abfb-1b9d9df2c398"},{"version":"CommandV1","origId":779539500128668,"guid":"a03fa7f0-8754-45a2-b2b0-3927fbb1a2d4","subtype":"command","commandType":"auto","position":5.0,"command":"def _create_pipeline():\n    \"Provided by DBAcademy, this function creates the prescribed pipline\"\n    \n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    pipeline_name, path, source = get_pipeline_config()\n\n    # Delete the existing pipeline if it exists\n    client.pipelines().delete_by_name(pipeline_name)\n\n    # Create the new pipeline\n    pipeline = client.pipelines().create(\n        name = pipeline_name, \n        storage = f\"{DA.paths.working_dir}/storage\", \n        target = DA.db_name, \n        notebooks = [path],\n        configuration = {\"source\": source})\n\n    DA.pipline_id = pipeline.get(\"pipeline_id\")\n       \nDA.create_pipeline = _create_pipeline","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a47cc6ed-4abc-4084-be56-436825a4ec0f"},{"version":"CommandV1","origId":779539500128669,"guid":"e29fc010-02e9-4ddb-b7ef-8763dbd91ef2","subtype":"command","commandType":"auto","position":6.0,"command":"def _start_pipeline():\n    \"Provided by DBAcademy, this function starts the pipline and then blocks until it has completed, failed or was canceled\"\n\n    import time\n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    # Start the pipeline\n    start = client.pipelines().start_by_id(DA.pipline_id)\n    update_id = start.get(\"update_id\")\n\n    # Get the status and block until it is done\n    update = client.pipelines().get_update_by_id(DA.pipline_id, update_id)\n    state = update.get(\"update\").get(\"state\")\n\n    done = [\"COMPLETED\", \"FAILED\", \"CANCELED\"]\n    while state not in done:\n        duration = 15\n        time.sleep(duration)\n        print(f\"Current state is {state}, sleeping {duration} seconds.\")    \n        update = client.pipelines().get_update_by_id(DA.pipline_id, update_id)\n        state = update.get(\"update\").get(\"state\")\n    \n    print(f\"The final state is {state}.\")    \n    assert state == \"COMPLETED\", f\"Expected the state to be COMPLETED, found {state}\"\n\nDA.start_pipeline = _start_pipeline    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a54835e4-9c41-437b-a2b0-75a2c9f59eb4"},{"version":"CommandV1","origId":779539500128670,"guid":"fd031c04-6a03-4a92-8ce0-33740051061e","subtype":"command","commandType":"auto","position":7.0,"command":"DA.cleanup()\nDA.init()\n\n# DA.paths.data_source = \"/mnt/training/healthcare\"\n# DA.paths.storage_location = f\"{DA.paths.working_dir}/storage\"\n# DA.paths.data_landing_location    = f\"{DA.paths.working_dir}/source/tracker\"\n\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c7c73990-467b-472d-bd09-e3fc9681dd0f"}],"dashboards":[],"guid":"68b21bb7-4043-4a23-aefe-b2bdb7f1c109","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}