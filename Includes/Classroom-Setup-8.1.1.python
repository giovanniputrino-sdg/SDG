{"version":"NotebookV1","origId":779539500128782,"name":"Classroom-Setup-8.1.1","language":"python","commands":[{"version":"CommandV1","origId":779539500128783,"guid":"0a21d642-e8ad-42ff-970d-450c7e63843a","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"dlt_demo_81\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9368a82e-092e-4515-9a89-ba45a1b3940d"},{"version":"CommandV1","origId":779539500128784,"guid":"a949e516-4048-4cf6-9820-6a4f41ed3aff","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9749e78c-9c99-41e7-a5fb-e5fd4d2503d4"},{"version":"CommandV1","origId":779539500128785,"guid":"85ef4f9d-3cfe-4845-b6dd-eb0431138320","subtype":"command","commandType":"auto","position":4.0,"command":"def get_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 8.1.2 - SQL for Delta Live Tables\"\n    \n    return f\"DLT-Demo-81-{DA.username}\", path\n    \ndef _print_pipeline_config():\n    \"Provided by DBAcademy, this function renders the configuration of the pipeline as HTML\"\n    pipeline_name, path = get_pipeline_config()\n    \n    displayHTML(f\"\"\"<table style=\"width:100%\">\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Pipeline Name:</td>\n        <td><input type=\"text\" value=\"{pipeline_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Target:</td>\n        <td><input type=\"text\" value=\"{DA.db_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Storage Location:</td>\n        <td><input type=\"text\" value=\"{DA.paths.storage_location}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Notebook Path:</td>\n        <td><input type=\"text\" value=\"{path}\" style=\"width:100%\"></td></tr>\n    </table>\"\"\")\n    \nDA.print_pipeline_config = _print_pipeline_config","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4e827124-148c-4a28-be78-7eb706b81bae"},{"version":"CommandV1","origId":779539500128786,"guid":"96cbede3-ef58-4a58-a451-c44942ad81f0","subtype":"command","commandType":"auto","position":5.0,"command":"def _create_pipeline():\n    \"Provided by DBAcademy, this function creates the prescribed pipline\"\n    \n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    pipeline_name, path = get_pipeline_config()\n\n    # Delete the existing pipeline if it exists\n    client.pipelines().delete_by_name(pipeline_name)\n\n    # Create the new pipeline\n    pipeline = client.pipelines().create(\n        name = pipeline_name, \n        storage = DA.paths.storage_location, \n        target = DA.db_name, \n        notebooks = [path])\n\n    DA.pipeline_id = pipeline.get(\"pipeline_id\")\n       \nDA.create_pipeline = _create_pipeline","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6643b089-b633-4184-aa0f-37f9c86b61e6"},{"version":"CommandV1","origId":779539500128787,"guid":"c86625c0-fae1-4d70-aefd-ca6ee50a617b","subtype":"command","commandType":"auto","position":6.0,"command":"def _start_pipeline():\n    \"Provided by DBAcademy, this function starts the pipeline and then blocks until it has completed, failed or was canceled\"\n\n    import time\n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    # Start the pipeline\n    start = client.pipelines().start_by_id(DA.pipeline_id)\n    update_id = start.get(\"update_id\")\n\n    # Get the status and block until it is done\n    update = client.pipelines().get_update_by_id(DA.pipeline_id, update_id)\n    state = update.get(\"update\").get(\"state\")\n\n    done = [\"COMPLETED\", \"FAILED\", \"CANCELED\"]\n    while state not in done:\n        duration = 15\n        time.sleep(duration)\n        print(f\"Current state is {state}, sleeping {duration} seconds.\")    \n        update = client.pipelines().get_update_by_id(DA.pipeline_id, update_id)\n        state = update.get(\"update\").get(\"state\")\n    \n    print(f\"The final state is {state}.\")    \n    assert state == \"COMPLETED\", f\"Expected the state to be COMPLETED, found {state}\"\n\nDA.start_pipeline = _start_pipeline    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0b2e3e0b-8f41-4614-938d-cd7727090db6"},{"version":"CommandV1","origId":779539500128788,"guid":"f691b981-271b-4c3a-9cd3-51b5081e9de0","subtype":"command","commandType":"auto","position":7.0,"command":"DA.cleanup()\nDA.init()\n\nDA.paths.data_source = \"/mnt/training/healthcare\"\nDA.paths.storage_location = f\"{DA.paths.working_dir}/storage\"\nDA.paths.data_landing_location    = f\"{DA.paths.working_dir}/source/tracker\"\n\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"dd76b940-503b-45fb-92c2-706de0c9c314"}],"dashboards":[],"guid":"fb96231f-7f21-43f5-83ef-d2d0507e12ef","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}