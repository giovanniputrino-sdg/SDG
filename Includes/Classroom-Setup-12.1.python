{"version":"NotebookV1","origId":779539500128712,"name":"Classroom-Setup-12.1","language":"python","commands":[{"version":"CommandV1","origId":779539500128713,"guid":"c6ace14a-4935-4c23-977f-b8c81fce8044","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"12.1\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0f0917d9-8b50-475f-971b-ece71c86cb94"},{"version":"CommandV1","origId":779539500128714,"guid":"7c660b12-9f55-4df4-adc1-a37cd8b38647","subtype":"command","commandType":"auto","position":3.0,"command":"DA.cleanup()\nDA.init(create_db=False)\nDA.conclude_setup()","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ea1b995c-f4e0-4f6f-8f33-ab1574094159"},{"version":"CommandV1","origId":779539500128715,"guid":"7c013808-c193-4961-a240-4f5991b3fcbf","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    html = f\"<textarea style=\\\"width:100%\\\" rows={rows}> \\n{sql.strip()}</textarea>\"\n    displayHTML(html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cd46f23a-5045-4d39-bd1e-8917a2fbdfa4"},{"version":"CommandV1","origId":779539500128716,"guid":"ee53de81-3264-459b-bbee-ec9cef676538","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_config():\n    print_sql(33, f\"\"\"\nCREATE DATABASE IF NOT EXISTS {DA.db_name}\nLOCATION '{DA.paths.working_dir}';\n\nUSE {DA.db_name};\n\nCREATE TABLE user_ping \n(user_id STRING, ping INTEGER, time TIMESTAMP); \n\nCREATE TABLE user_ids (user_id STRING);\n\nINSERT INTO user_ids VALUES\n(\"potato_luver\"),\n(\"beanbag_lyfe\"),\n(\"default_username\"),\n(\"the_king\"),\n(\"n00b\"),\n(\"frodo\"),\n(\"data_the_kid\"),\n(\"el_matador\"),\n(\"the_wiz\");\n\nCREATE FUNCTION get_ping()\n    RETURNS INT\n    RETURN int(rand() * 250);\n    \nCREATE FUNCTION is_active()\n    RETURNS BOOLEAN\n    RETURN CASE \n        WHEN rand() > .25 THEN true\n        ELSE false\n        END;\n\"\"\")\n    \nDA.generate_config = _generate_config    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cf7bd6ed-b856-41dc-acd5-d2231cf2a7cb"},{"version":"CommandV1","origId":779539500128717,"guid":"b77dba07-9114-4e6e-b40e-1f064f344a94","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_load():\n    print_sql(12, f\"\"\"\nUSE {DA.db_name};\n\nINSERT INTO user_ping\nSELECT *, \n  get_ping() ping, \n  current_timestamp() time\nFROM user_ids\nWHERE is_active()=true;\n\nSELECT * FROM user_ping;\n\"\"\")\n\nDA.generate_load = _generate_load","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"bf3a62d1-866c-41fc-837c-a156a6d97d12"},{"version":"CommandV1","origId":779539500128718,"guid":"caaff6c2-99b2-4615-b03e-20eebea177bc","subtype":"command","commandType":"auto","position":7.0,"command":"def _generate_user_counts():\n    print_sql(10, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, count(*) total_records\nFROM user_ping\nGROUP BY user_id\nORDER BY \n  total_records DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_user_counts = _generate_user_counts","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5f70f04e-10e3-4b77-90e2-ea8475134bd3"},{"version":"CommandV1","origId":779539500128719,"guid":"6da85953-dc77-401f-8757-1f144e5e6b64","subtype":"command","commandType":"auto","position":8.0,"command":"def _generate_avg_ping():\n    print_sql(10, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, window.end end_time, mean(ping) avg_ping\nFROM user_ping\nGROUP BY user_id, window(time, '3 minutes')\nORDER BY\n  end_time DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_avg_ping = _generate_avg_ping","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fa6d025c-00be-41e0-92d1-9079a78af39d"},{"version":"CommandV1","origId":779539500128720,"guid":"4652fb95-eb57-4e7b-9016-b6aee6e91465","subtype":"command","commandType":"auto","position":9.0,"command":"def _generate_summary():\n    print_sql(8, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, min(time) first_seen, max(time) last_seen, count(*) total_records, avg(ping) total_avg_ping\nFROM user_ping\nGROUP BY user_id\nORDER BY user_id ASC;\n\"\"\")\n    \nDA.generate_summary = _generate_summary\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2c6a8150-ef76-434c-b8ea-589aac8d8aa9"}],"dashboards":[],"guid":"5d47d789-549a-4fb0-a7da-861a8ce8a74e","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}