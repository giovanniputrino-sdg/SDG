{"version":"NotebookV1","origId":779539500130386,"name":"Classroom-Setup-12.1","language":"python","commands":[{"version":"CommandV1","origId":779539500130387,"guid":"bbcc5397-2c13-47cd-af81-c3bea54e94d1","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"12.1\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6dc2e7d3-09af-4f45-a857-e1154fbfdb20"},{"version":"CommandV1","origId":779539500130388,"guid":"8c9a21f6-1df8-40bf-a917-3404bc8b45fd","subtype":"command","commandType":"auto","position":3.0,"command":"DA.cleanup()\nDA.init(create_db=False)\nDA.conclude_setup()","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ff5826b2-7313-42e2-8b88-0991116ab5f5"},{"version":"CommandV1","origId":779539500130389,"guid":"81bc7599-5f72-423f-8cf4-23c061f00f7d","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    html = f\"<textarea style=\\\"width:100%\\\" rows={rows}> \\n{sql.strip()}</textarea>\"\n    displayHTML(html)","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"31e88554-5aed-4e31-b498-af478b957500"},{"version":"CommandV1","origId":779539500130390,"guid":"44539c51-d029-4dc9-a3cd-2d9580c3e322","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_config():\n    print_sql(33, f\"\"\"\nCREATE DATABASE IF NOT EXISTS {DA.db_name}\nLOCATION '{DA.paths.working_dir}';\n\nUSE {DA.db_name};\n\nCREATE TABLE user_ping \n(user_id STRING, ping INTEGER, time TIMESTAMP); \n\nCREATE TABLE user_ids (user_id STRING);\n\nINSERT INTO user_ids VALUES\n(\"potato_luver\"),\n(\"beanbag_lyfe\"),\n(\"default_username\"),\n(\"the_king\"),\n(\"n00b\"),\n(\"frodo\"),\n(\"data_the_kid\"),\n(\"el_matador\"),\n(\"the_wiz\");\n\nCREATE FUNCTION get_ping()\n    RETURNS INT\n    RETURN int(rand() * 250);\n    \nCREATE FUNCTION is_active()\n    RETURNS BOOLEAN\n    RETURN CASE \n        WHEN rand() > .25 THEN true\n        ELSE false\n        END;\n\"\"\")\n    \nDA.generate_config = _generate_config    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d8c768e5-4298-4863-8633-5566a8ee4f2d"},{"version":"CommandV1","origId":779539500130391,"guid":"27ec9095-0b84-435d-9d7d-1fd062cb8391","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_load():\n    print_sql(12, f\"\"\"\nUSE {DA.db_name};\n\nINSERT INTO user_ping\nSELECT *, \n  get_ping() ping, \n  current_timestamp() time\nFROM user_ids\nWHERE is_active()=true;\n\nSELECT * FROM user_ping;\n\"\"\")\n\nDA.generate_load = _generate_load","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c7480d94-adf3-435a-979f-bf53c00bb44f"},{"version":"CommandV1","origId":779539500130392,"guid":"88b33a01-8459-437c-9ea8-a8f16b0b7581","subtype":"command","commandType":"auto","position":7.0,"command":"def _generate_user_counts():\n    print_sql(10, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, count(*) total_records\nFROM user_ping\nGROUP BY user_id\nORDER BY \n  total_records DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_user_counts = _generate_user_counts","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5469a1b6-da88-4c84-8a91-4141ddb95e01"},{"version":"CommandV1","origId":779539500130393,"guid":"80ad0f70-19cb-4f84-a11a-2304362e48eb","subtype":"command","commandType":"auto","position":8.0,"command":"def _generate_avg_ping():\n    print_sql(10, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, window.end end_time, mean(ping) avg_ping\nFROM user_ping\nGROUP BY user_id, window(time, '3 minutes')\nORDER BY\n  end_time DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_avg_ping = _generate_avg_ping","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"41d030aa-d4af-4503-8240-e42b22e17a2e"},{"version":"CommandV1","origId":779539500130394,"guid":"27b8880f-dc99-475b-a774-93ffaa5a930b","subtype":"command","commandType":"auto","position":9.0,"command":"def _generate_summary():\n    print_sql(8, f\"\"\"\nUSE {DA.db_name};\n\nSELECT user_id, min(time) first_seen, max(time) last_seen, count(*) total_records, avg(ping) total_avg_ping\nFROM user_ping\nGROUP BY user_id\nORDER BY user_id ASC;\n\"\"\")\n    \nDA.generate_summary = _generate_summary\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"217134c9-6c52-480f-8c19-406cd86ff9b3"}],"dashboards":[],"guid":"d72963cf-09df-4e40-94f9-a050b9321bc3","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}