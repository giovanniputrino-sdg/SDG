{"version":"NotebookV1","origId":779539500130341,"name":"Classroom-Setup-12.2.1L","language":"python","commands":[{"version":"CommandV1","origId":779539500130342,"guid":"23c39953-4625-41fe-81ee-83e0251fa76f","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"cap_12\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ea76973c-cbcb-489a-b0ab-4217fef0b52f"},{"version":"CommandV1","origId":779539500130343,"guid":"1fb43a2f-e6bc-4737-ac63-d961f3ef1e77","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"37f6828c-2f0d-4b68-b07e-5d4732e82548"},{"version":"CommandV1","origId":779539500130344,"guid":"0ec33270-3deb-4f21-93ec-966f1c99506e","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    displayHTML(f\"\"\"<body><textarea style=\"width:100%\" rows={rows}> \\n{sql.strip()}</textarea></body>\"\"\")\n    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"48ab4fbe-efd5-48e3-bd8e-89561adc9464"},{"version":"CommandV1","origId":779539500130345,"guid":"4c44411c-b1a7-4194-8ad9-b39aac40eb8b","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_daily_patient_avg():\n    sql = f\"SELECT * FROM {DA.db_name}.daily_patient_avg\"\n    print_sql(3, sql)\n\nDA.generate_daily_patient_avg = _generate_daily_patient_avg","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9a433ca6-27cd-453a-a3df-d525f80ff18a"},{"version":"CommandV1","origId":779539500130346,"guid":"5dd2f8c5-eb19-415c-a11e-19a903929831","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_visualization_query():\n    sql = f\"\"\"\nSELECT flow_name, timestamp, int(details:flow_progress:metrics:num_output_rows) num_output_rows\nFROM {DA.db_name}.dlt_metrics\nORDER BY timestamp DESC;\"\"\"\n    \n    print_sql(5, sql)\n\nDA.generate_visualization_query = _generate_visualization_query","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"dd2a6fc4-be13-4e32-9f49-a2d15cb666e0"},{"version":"CommandV1","origId":779539500130347,"guid":"518c1bf1-dfee-4af2-9f01-dc97cfee10cf","subtype":"command","commandType":"auto","position":7.0,"command":"generate_register_dlt_event_metrics_sql_string = \"\"\n\ndef _generate_register_dlt_event_metrics_sql():\n    global generate_register_dlt_event_metrics_sql_string\n    \n    generate_register_dlt_event_metrics_sql_string = f\"\"\"\nCREATE TABLE IF NOT EXISTS {DA.db_name}.dlt_events\nLOCATION '{DA.paths.working_dir}/storage/system/events';\n\nCREATE VIEW IF NOT EXISTS {DA.db_name}.dlt_success AS\nSELECT * FROM {DA.db_name}.dlt_events\nWHERE details:flow_progress:metrics IS NOT NULL;\n\nCREATE VIEW IF NOT EXISTS {DA.db_name}.dlt_metrics AS\nSELECT timestamp, origin.flow_name, details \nFROM {DA.db_name}.dlt_success\nORDER BY timestamp DESC;\"\"\".strip()\n    \n    print_sql(13, generate_register_dlt_event_metrics_sql_string)\n    \nDA.generate_register_dlt_event_metrics_sql = _generate_register_dlt_event_metrics_sql","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"5ca6dd6e-1ab0-4fd5-91f6-dbd7800cafd9"},{"version":"CommandV1","origId":779539500130348,"guid":"6577e888-2922-4a72-928b-be541a741b10","subtype":"command","commandType":"auto","position":8.0,"command":"def print_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 12.2.2L - DLT Task\"\n\n    displayHTML(f\"\"\"<table>\n    <tr><td style=\"white-space:nowrap\">Pipeline Name:</td><td><b>Cap-12-{DA.username}</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Source:</td><td><b>{DA.paths.working_dir}/source/tracker</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Target:</td><td><b>{DA.db_name}</b></td></tr>\n    <tr><td style=\"white-space:nowrap\">Storage Location:</td><td><b>{DA.paths.working_dir}/storage</b></td></tr>\n    <tr><td style=\"white-space:nowrap\" style=\"white-space:nowrap\">Notebook Path:</td><td><b>{path}</b></td></tr>\n    </table>\"\"\")\n    \ndef print_job_config():\n    displayHTML(f\"\"\"<table>\n    <tr><td style=\"white-space:nowrap\">Job Name:</td><td><b>Cap-12-{DA.username}</b></td></tr>\n    </table>\"\"\")","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"40fd2e58-6a3b-453f-801a-2e37964e682d"},{"version":"CommandV1","origId":779539500130349,"guid":"f853e18f-743f-43bf-9f5b-20f129a13506","subtype":"command","commandType":"auto","position":9.0,"command":"DA.cleanup()\nDA.init()\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6409374b-416a-4ecf-9027-1aa142415842"}],"dashboards":[],"guid":"6fbe9654-cbd0-4514-bcdc-c495a8b12c17","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}