{"version":"NotebookV1","origId":779539500130221,"name":"Classroom-Setup-8.2.1L","language":"python","commands":[{"version":"CommandV1","origId":779539500130222,"guid":"828128e9-5a60-4696-a066-e67183fbbcfc","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"dlt_lab_82\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6223eaeb-fa08-456d-880b-707d507e4b0a"},{"version":"CommandV1","origId":779539500130223,"guid":"1e998772-7926-4374-b990-fb25ec8b9a65","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"9853c661-e1ac-45c0-a42c-b393c40fd11e"},{"version":"CommandV1","origId":779539500130224,"guid":"f41caa0c-64a7-4501-aced-67658362face","subtype":"command","commandType":"auto","position":4.0,"command":"def get_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 8.2.2L - Migrating a SQL Pipeline to DLT Lab\"\n    \n    pipeline_name = f\"DLT-Lab-82L-{DA.username}\"\n    source = f\"{DA.paths.working_dir}/source/tracker\"\n    return pipeline_name, path, source\n    \ndef _print_pipeline_config():\n    \"Provided by DBAcademy, this function renders the configuration of the pipeline as HTML\"\n    pipeline_name, path, source = get_pipeline_config()\n    \n    displayHTML(f\"\"\"<table style=\"width:100%\">\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Pipeline Name:</td>\n        <td><input type=\"text\" value=\"{pipeline_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Target:</td>\n        <td><input type=\"text\" value=\"{DA.db_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Storage Location:</td>\n        <td><input type=\"text\" value=\"{DA.paths.working_dir}/storage\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Notebook Path:</td>\n        <td><input type=\"text\" value=\"{path}\" style=\"width:100%\"></td>\n    </tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Source:</td>\n        <td><input type=\"text\" value=\"{source}\" style=\"width:100%\"></td>\n    </tr>\n    </table>\"\"\")\n    \nDA.print_pipeline_config = _print_pipeline_config    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4c97b8e8-716a-4e99-af4e-a9635c8b1aba"},{"version":"CommandV1","origId":779539500130225,"guid":"b6d51d50-b78b-4b41-a78c-82e0a59ad1dd","subtype":"command","commandType":"auto","position":5.0,"command":"def _create_pipeline():\n    \"Provided by DBAcademy, this function creates the prescribed pipline\"\n    \n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    pipeline_name, path, source = get_pipeline_config()\n\n    # Delete the existing pipeline if it exists\n    client.pipelines().delete_by_name(pipeline_name)\n\n    # Create the new pipeline\n    pipeline = client.pipelines().create(\n        name = pipeline_name, \n        storage = f\"{DA.paths.working_dir}/storage\", \n        target = DA.db_name, \n        notebooks = [path],\n        configuration = {\"source\": source})\n\n    DA.pipline_id = pipeline.get(\"pipeline_id\")\n       \nDA.create_pipeline = _create_pipeline","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fe70e3c0-34a9-44ab-b522-cf5bfc2fbb96"},{"version":"CommandV1","origId":779539500130226,"guid":"4dda2e42-d4ed-4df6-8267-b2fd2af014e3","subtype":"command","commandType":"auto","position":6.0,"command":"def _start_pipeline():\n    \"Provided by DBAcademy, this function starts the pipline and then blocks until it has completed, failed or was canceled\"\n\n    import time\n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    # Start the pipeline\n    start = client.pipelines().start_by_id(DA.pipline_id)\n    update_id = start.get(\"update_id\")\n\n    # Get the status and block until it is done\n    update = client.pipelines().get_update_by_id(DA.pipline_id, update_id)\n    state = update.get(\"update\").get(\"state\")\n\n    done = [\"COMPLETED\", \"FAILED\", \"CANCELED\"]\n    while state not in done:\n        duration = 15\n        time.sleep(duration)\n        print(f\"Current state is {state}, sleeping {duration} seconds.\")    \n        update = client.pipelines().get_update_by_id(DA.pipline_id, update_id)\n        state = update.get(\"update\").get(\"state\")\n    \n    print(f\"The final state is {state}.\")    \n    assert state == \"COMPLETED\", f\"Expected the state to be COMPLETED, found {state}\"\n\nDA.start_pipeline = _start_pipeline    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"99bab80f-7185-474a-86a0-f0f88b0fd406"},{"version":"CommandV1","origId":779539500130227,"guid":"59d9ec1d-d170-4705-96fa-3d3460b96080","subtype":"command","commandType":"auto","position":7.0,"command":"DA.cleanup()\nDA.init()\n\n# DA.paths.data_source = \"/mnt/training/healthcare\"\n# DA.paths.storage_location = f\"{DA.paths.working_dir}/storage\"\n# DA.paths.data_landing_location    = f\"{DA.paths.working_dir}/source/tracker\"\n\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"ec4ad85c-0be7-43f3-b770-2f36b5492da8"}],"dashboards":[],"guid":"cabeacd7-9f77-416a-8796-59c90b208e22","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}