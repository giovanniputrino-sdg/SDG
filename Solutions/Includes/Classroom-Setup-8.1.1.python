{"version":"NotebookV1","origId":779539500130228,"name":"Classroom-Setup-8.1.1","language":"python","commands":[{"version":"CommandV1","origId":779539500130229,"guid":"fb4db646-fd88-4ff0-968e-bca8221f6b10","subtype":"command","commandType":"auto","position":2.0,"command":"%run ./_utility-methods $lesson=\"dlt_demo_81\"","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2b50dc1e-a8d3-4659-af86-3b3d2361433c"},{"version":"CommandV1","origId":779539500130230,"guid":"0b912a41-65fb-4fac-88f0-a81efc596a61","subtype":"command","commandType":"auto","position":3.0,"command":"%run ./mount-datasets","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a07fa184-1c07-489c-ab55-88ae9c17c2a2"},{"version":"CommandV1","origId":779539500130231,"guid":"e1bc562a-b272-4274-9432-f21c62ed38c2","subtype":"command","commandType":"auto","position":4.0,"command":"def get_pipeline_config():\n    path = dbutils.entry_point.getDbutils().notebook().getContext().notebookPath().getOrElse(None)\n    path = \"/\".join(path.split(\"/\")[:-1]) + \"/DE 8.1.2 - SQL for Delta Live Tables\"\n    \n    return f\"DLT-Demo-81-{DA.username}\", path\n    \ndef _print_pipeline_config():\n    \"Provided by DBAcademy, this function renders the configuration of the pipeline as HTML\"\n    pipeline_name, path = get_pipeline_config()\n    \n    displayHTML(f\"\"\"<table style=\"width:100%\">\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Pipeline Name:</td>\n        <td><input type=\"text\" value=\"{pipeline_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Target:</td>\n        <td><input type=\"text\" value=\"{DA.db_name}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Storage Location:</td>\n        <td><input type=\"text\" value=\"{DA.paths.storage_location}\" style=\"width:100%\"></td></tr>\n    <tr>\n        <td style=\"white-space:nowrap; width:1em\">Notebook Path:</td>\n        <td><input type=\"text\" value=\"{path}\" style=\"width:100%\"></td></tr>\n    </table>\"\"\")\n    \nDA.print_pipeline_config = _print_pipeline_config","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"69f79d51-76d0-4f7d-b009-2883d01945bc"},{"version":"CommandV1","origId":779539500130232,"guid":"18a95f3c-5b93-4d69-bb2a-964d5082a5de","subtype":"command","commandType":"auto","position":5.0,"command":"def _create_pipeline():\n    \"Provided by DBAcademy, this function creates the prescribed pipline\"\n    \n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    pipeline_name, path = get_pipeline_config()\n\n    # Delete the existing pipeline if it exists\n    client.pipelines().delete_by_name(pipeline_name)\n\n    # Create the new pipeline\n    pipeline = client.pipelines().create(\n        name = pipeline_name, \n        storage = DA.paths.storage_location, \n        target = DA.db_name, \n        notebooks = [path])\n\n    DA.pipeline_id = pipeline.get(\"pipeline_id\")\n       \nDA.create_pipeline = _create_pipeline","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7bd287f7-575f-4eef-810d-37be26f4f0e4"},{"version":"CommandV1","origId":779539500130233,"guid":"4ded5402-c0b8-43fc-bdd1-bec69df37e95","subtype":"command","commandType":"auto","position":6.0,"command":"def _start_pipeline():\n    \"Provided by DBAcademy, this function starts the pipeline and then blocks until it has completed, failed or was canceled\"\n\n    import time\n    from dbacademy.dbrest import DBAcademyRestClient\n    client = DBAcademyRestClient()\n\n    # Start the pipeline\n    start = client.pipelines().start_by_id(DA.pipeline_id)\n    update_id = start.get(\"update_id\")\n\n    # Get the status and block until it is done\n    update = client.pipelines().get_update_by_id(DA.pipeline_id, update_id)\n    state = update.get(\"update\").get(\"state\")\n\n    done = [\"COMPLETED\", \"FAILED\", \"CANCELED\"]\n    while state not in done:\n        duration = 15\n        time.sleep(duration)\n        print(f\"Current state is {state}, sleeping {duration} seconds.\")    \n        update = client.pipelines().get_update_by_id(DA.pipeline_id, update_id)\n        state = update.get(\"update\").get(\"state\")\n    \n    print(f\"The final state is {state}.\")    \n    assert state == \"COMPLETED\", f\"Expected the state to be COMPLETED, found {state}\"\n\nDA.start_pipeline = _start_pipeline    ","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4564a220-0e80-4ded-a138-9912528762a7"},{"version":"CommandV1","origId":779539500130234,"guid":"37743103-749e-49c3-98c3-78f56d2b40ad","subtype":"command","commandType":"auto","position":7.0,"command":"DA.cleanup()\nDA.init()\n\nDA.paths.data_source = \"/mnt/training/healthcare\"\nDA.paths.storage_location = f\"{DA.paths.working_dir}/storage\"\nDA.paths.data_landing_location    = f\"{DA.paths.working_dir}/source/tracker\"\n\nDA.data_factory = DltDataFactory()\nDA.conclude_setup()\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"15d49dc3-048d-43d5-b37d-8ac8300d60c0"}],"dashboards":[],"guid":"5ceb9655-5e9e-42b8-b1cb-9c74d20eef83","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}