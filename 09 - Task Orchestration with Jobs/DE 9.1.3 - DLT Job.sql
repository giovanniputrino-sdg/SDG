{"version":"NotebookV1","origId":779539500128239,"name":"DE 9.1.3 - DLT Job","language":"sql","commands":[{"version":"CommandV1","origId":779539500128240,"guid":"899be5a2-ce0c-4322-9fb5-61d6dba21c07","subtype":"command","commandType":"auto","position":2.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_raw\nCOMMENT \"The raw sales orders, ingested from /databricks-datasets.\"\nAS\nSELECT * FROM cloud_files(\"/databricks-datasets/retail-org/sales_orders/\", \"json\", map(\"cloudFiles.inferColumnTypes\", \"true\"))","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"1530e66f-6e87-4c3b-b1a1-cd364d3e9c03"},{"version":"CommandV1","origId":779539500128241,"guid":"8db0e2ba-f455-4772-80b2-295d94ec2b87","subtype":"command","commandType":"auto","position":3.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE customers\nCOMMENT \"The customers buying finished products, ingested from /databricks-datasets.\"\nAS SELECT * FROM cloud_files(\"/databricks-datasets/retail-org/customers/\", \"csv\");","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"cc16d161-ea25-46e8-829d-bddb6c392acf"},{"version":"CommandV1","origId":779539500128242,"guid":"fd859d8e-75ce-4c59-8715-36c418a83f45","subtype":"command","commandType":"auto","position":4.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_cleaned(\n  CONSTRAINT valid_order_number EXPECT (order_number IS NOT NULL) ON VIOLATION DROP ROW\n)\nCOMMENT \"The cleaned sales orders with valid order_number(s) and partitioned by order_datetime.\"\nAS\nSELECT f.customer_id, f.customer_name, f.number_of_line_items, \n  TIMESTAMP(from_unixtime((cast(f.order_datetime as long)))) as order_datetime, \n  DATE(from_unixtime((cast(f.order_datetime as long)))) as order_date, \n  f.order_number, f.ordered_products, c.state, c.city, c.lon, c.lat, c.units_purchased, c.loyalty_segment\n  FROM STREAM(LIVE.sales_orders_raw) f\n  LEFT JOIN LIVE.customers c\n      ON c.customer_id = f.customer_id\n     AND c.customer_name = f.customer_name","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"32aa2169-d1d7-4501-b34b-e8e88aa36fb9"},{"version":"CommandV1","origId":779539500128243,"guid":"9c9a353f-1619-4e03-9fc4-bf781114e55c","subtype":"command","commandType":"auto","position":5.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_la\nCOMMENT \"Sales orders in LA.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Los Angeles'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6a7b5417-332f-48f4-9745-d0805c715c99"},{"version":"CommandV1","origId":779539500128244,"guid":"d0a13116-7b7d-48c6-a383-ef82c6c76287","subtype":"command","commandType":"auto","position":6.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_chicago\nCOMMENT \"Sales orders in Chicago.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Chicago'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr\n","commandVersion":1,"state":"finished","results":{"type":"raw","data":"","arguments":{},"metadata":{}},"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"66784aa0-70ce-48c8-8da7-cc7c15120782"}],"dashboards":[],"guid":"cbb236d3-5c35-4889-9c18-3c50f4c76b73","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{"pythonIndentUnit":2},"reposExportFormat":"SOURCE"}